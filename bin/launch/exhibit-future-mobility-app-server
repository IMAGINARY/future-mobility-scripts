#!/bin/bash
# This wrapper script is supposed to be visible in ps -a resp. ps -u `id -u` to make
# it easy to kill it (by a script or manually)

PIDS=""
function finish {
    EXIT_CODE=$?
    kill $PIDS >/dev/null 2>&1
    exit $EXIT_CODE
}
trap finish SIGINT SIGTERM EXIT

# Launch the future-mobility server
cd "/opt/future-mobility/future-mobility/server" || exit 1
NODEJS_PATH="/opt/future-mobility/nodejs/bin"
PATH="$NODEJS_PATH:$PATH" npm run start &
PID_SERVER="$!"
PIDS="$PIDS $PID_SERVER"

# Wait for the server to finish or until the signal trap is triggered
wait $PID_SERVER
exit $?